================================================================================
                    API CALL SUMMARY - INTRANSIT BACKEND
================================================================================

ğŸ“Š FRONTEND ENDPOINTS (User requests):
================================================================================

1ï¸âƒ£ GET /api/orders/ofd/ 
   Purpose: Show OFD & Undelivered orders
   Calls iThink API: 
      - get_orders_by_date_range() [First time only or after 2hr]
      - track_orders() [For phone numbers, batch of 30]
   Cache: Database cache (instant response)
   Working Hours: 9:50 AM - 1:30 PM only
   Sync Frequency: Every 2 hours (if within working hours)

2ï¸âƒ£ GET /api/orders/call-history/
   Purpose: Show today's call history
   Calls iThink API: NO
   Calls VAPI API: YES (to get call list)
   Cache: 5 minutes
   
3ï¸âƒ£ GET /api/orders/in-transit/
   Purpose: Show delayed in-transit orders
   Calls iThink API:
      - get_orders_by_date_range() [Every time]
      - track_orders() [For verification, batch of 30]
   Cache: 15 minutes
   
4ï¸âƒ£ GET /api/orders/ready-to-dispatch/
   Purpose: Show ready to dispatch orders
   Calls iThink API:
      - get_orders_by_date_range() [Every time]
      - track_orders() [For verification, batch of 30]
   Cache: 15 minutes

5ï¸âƒ£ POST /api/orders/make-call/
   Purpose: Make individual call to customer
   Calls VAPI API: YES (create phone call)
   
6ï¸âƒ£ GET /api/orders/scheduler/
   Purpose: Get scheduler status
   Calls API: NO (internal status only)

7ï¸âƒ£ POST /api/orders/cleanup-delivered/
   Purpose: Manual cleanup of delivered orders
   Calls iThink API:
      - track_orders() [Batch of 30, for all orders]
   
================================================================================

ğŸ¤– AUTOMATIC/SCHEDULED CALLS:
================================================================================

8ï¸âƒ£ Scheduler Auto-Sync (Before each call session)
   When: Before 10:30, 11, 12, 1 PM calls
   Calls iThink API:
      - get_orders_by_date_range() [To get fresh OFD/Undelivered]
      - track_orders() [For phone numbers]
   
9ï¸âƒ£ Scheduler Calls (4 times daily)
   When: 10:30 AM, 11 AM, 12 PM, 1 PM
   Calls VAPI API: YES (make calls to pending orders)
   Smart filtering: 2-hour cooldown, max 3 retries

ğŸ”Ÿ Daily Cleanup
   When: 9:45 AM
   Calls API: NO (just deletes local database)

================================================================================

ğŸ“ˆ ITHINK API CALL BREAKDOWN:
================================================================================

API: get_orders_by_date_range(start_date, end_date)
Used by:
   - OFD Orders (every 2 hours during working hours)
   - In-Transit (every 15 min via cache)
   - Ready to Dispatch (every 15 min via cache)
   - Scheduler (before each call session)

API: track_orders(awb_list)
Used by:
   - OFD Orders (for phone numbers, cached 10 min)
   - In-Transit (for verification, batch of 30)
   - Ready to Dispatch (for verification, batch of 30)
   - Cleanup (batch of 30)
   - Scheduler (for phone numbers)

================================================================================

â° DAILY TIMELINE (What happens when):
================================================================================

9:45 AM  â†’ ğŸ—‘ï¸ Auto Cleanup (delete all data)
9:50 AM  â†’ ğŸŸ¢ API calls allowed to start
10:30 AM â†’ ğŸ“ Call session 1 + Fresh sync
11:00 AM â†’ ğŸ“ Call session 2 + Fresh sync  
12:00 PM â†’ ğŸ“ Call session 3 + Fresh sync
1:00 PM  â†’ ğŸ“ Call session 4 + Fresh sync
1:30 PM  â†’ ğŸ”´ API calls STOP (no more syncs)

Throughout day:
- Frontend polling (every 30 seconds during calls, else 30 min)
- Cache hits reduce actual API calls
- Working hours: 9:50 AM - 1:30 PM

================================================================================

ğŸ’¾ CACHE STRATEGY:
================================================================================

1. OFD Orders: Database cache (instant) + 2hr sync
2. Call History: 5 min cache
3. Phone Numbers: 10 min cache
4. In-Transit: 15 min cache
5. Ready to Dispatch: 15 min cache

================================================================================

ğŸ¯ OPTIMIZATION DONE:
================================================================================

âœ… Working hours restriction (9:50 AM - 1:30 PM)
âœ… 2-hour sync interval (was 30 min)
âœ… 10-min phone cache
âœ… 5-min call history cache  
âœ… Database caching for instant response
âœ… Batch processing (30 AWBs per call)
âœ… Smart call filtering (2hr cooldown)

================================================================================
